#=====================================================================================================================
#Import Libraries
#=====================================================================================================================
import streamlit as st
import pandas as pd

#=====================================================================================================================
# Upload the CSV file
#=====================================================================================================================
uploaded_file = st.file_uploader("Upload a CSV file", type=["csv"])

if uploaded_file is not None:
    #=====================================================================================================================
    # Read the uploaded CSV file
    #=====================================================================================================================
    Table1 = pd.read_csv(uploaded_file, low_memory=False)

    #=====================================================================================================================
    # Rename columns
    #=====================================================================================================================
    Table1.rename(columns={
        'Customer name (customer)': 'Customer',
        'Fee (charge)': 'Fee',
        'Quantity (charge)': 'Quantity',
        'Total (charge)': 'Total',
    }, inplace=True)

    #=====================================================================================================================
    # Check for and count null values in 'Quantity' and 'Total' columns
    #=====================================================================================================================
    null_quantity_count = Table1['Quantity'].isnull().sum()
    null_total_count = Table1['Total'].isnull().sum()

    #=====================================================================================================================
    # Filter out rows with null values in 'Quantity' and 'Total' columns
    #=====================================================================================================================
    Table1 = Table1.dropna(subset=['Quantity', 'Total'])

    #=====================================================================================================================
    # Convert object to float64
    #=====================================================================================================================
    Table1['Quantity'] = pd.to_numeric(Table1['Quantity'], errors='coerce')
    Table1['Total'] = pd.to_numeric(Table1['Total'], errors='coerce')

    #=====================================================================================================================
    # Recreate the pivot table without the 'Description' column and compute the grand total for all customers
    #=====================================================================================================================
    pivot_table = Table1.pivot_table(index='Customer',
                                     values=['Quantity', 'Total'],
                                     aggfunc='sum')

    #=====================================================================================================================
    # Compute the grand total of 'Quantity' and 'Total'
    #=====================================================================================================================
    grand_total = pivot_table.sum()

    #=====================================================================================================================
    # Reset the index to make it look cleaner
    #=====================================================================================================================
    pivot_table.reset_index(inplace=True)

    #=====================================================================================================================
    # Display the pivot table in tabular form
    #=====================================================================================================================
    st.subheader("Pivot Table:")
    st.dataframe(pivot_table)

    #=====================================================================================================================
    # Display the grand total
    #=====================================================================================================================
    st.subheader("Grand Total:")
   st.dataframe(grand_total)
